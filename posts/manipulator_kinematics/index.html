<!doctype html><html lang=en><head><title>マニピュレータ制御①～順運動学、逆運動学～</title>
<meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><link rel=stylesheet href=/application.36e080bd5c38a8530af0f9a5ef6865a6b54d3c4ee19713271788ee3a70dce63d.css integrity="sha256-NuCAvVw4qFMK8Pml72hlprVNPE7hlxMnF4juOnDc5j0="><meta property="og:url" content="https://takanezawa0829.github.io/posts/manipulator_kinematics/"><meta property="og:site_name" content="Takane's Site"><meta property="og:title" content="マニピュレータ制御①～順運動学、逆運動学～"><meta property="og:description" content="5自由度のマニピュレータの順運動学解、逆運動学解を求める。"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-07-14T15:37:54+09:00"><meta property="article:modified_time" content="2024-07-14T15:37:54+09:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="マニピュレータ制御①～順運動学、逆運動学～"><meta name=twitter:description content="5自由度のマニピュレータの順運動学解、逆運動学解を求める。"><meta name=description content="5自由度のマニピュレータの順運動学解、逆運動学解を求める。"><script>theme=localStorage.getItem("darkmode:color-scheme")||"system",theme=="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?theme="dark":theme="light"),document.documentElement.setAttribute("data-theme",theme)</script></head><body class="type-posts kind-page" data-bs-spy=scroll data-bs-target=#TableOfContents data-bs-offset=80><div class="container-fluid bg-secondary wrapper"><nav class="navbar navbar-expand-xl top-navbar shadow" id=top-navbar><div class=container><button class="navbar-toggler navbar-light" id=sidebar-toggler type=button>
<i data-feather=sidebar></i>
</button>
<a class=navbar-brand href=/>Takane's Site</a>
<button class="navbar-toggler navbar-light" id=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#top-nav-items aria-label=menu>
<i data-feather=menu></i></button><div class="collapse navbar-collapse dynamic-navbar" id=top-nav-items><ul class="nav navbar-nav ms-auto"><li class=nav-item><a class=nav-link href=/#home>Home</a></li><li class=nav-item><a class=nav-link href=/#about>About</a></li><li class=nav-item><a class=nav-link href=/#skills>Skills</a></li><li class=nav-item><a class=nav-link href=/#experiences>Experiences</a></li><li class=nav-item><a class=nav-link href=/#recent-posts>Recent Works</a></li><div id=top-navbar-divider></div><li class=nav-item><a class=nav-link id=blog-link href=/posts>Works</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=languageSelector role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false><span class="flag-icon flag-icon-gb"></span>
English</a><div class=dropdown-menu aria-labelledby=languageSelector><a class="dropdown-item nav-link languages-item" href=/ja/posts/manipulator_kinematics><span class="flag-icon flag-icon-ja"></span>
日本語
</a><a class="dropdown-item nav-link languages-item" href=/posts/manipulator_kinematics><span class="flag-icon flag-icon-gb"></span>
English</a></div></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=themeSelector role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false><img id=navbar-theme-icon-svg class=theme-icon src=/icons/moon-svgrepo-com.svg width=20 alt="Dark Theme"></a><div id=themeMenu class="dropdown-menu dropdown-menu-icons-only" aria-labelledby=themeSelector><a class="dropdown-item nav-link" href=# data-scheme=light><img class=theme-icon src=/icons/sun-svgrepo-com.svg width=20 alt="Light Theme">
</a><a class="dropdown-item nav-link" href=# data-scheme=dark><img class=theme-icon src=/icons/moon-svgrepo-com.svg width=20 alt="Dark Theme">
</a><a class="dropdown-item nav-link" href=# data-scheme=system><img class=theme-icon src=/icons/computer-svgrepo-com.svg width=20 alt="System Theme"></a></div></li></ul></div></div></nav><section class=sidebar-section id=sidebar-section><div class=sidebar-holder><div class=sidebar id=sidebar><form class=mx-auto method=get action=/search><input type=text name=keyword placeholder=Search data-search id=search-box></form><div class=sidebar-tree><ul class=tree id=tree><li id=list-heading><a href=/posts/ data-filter=all>Works</a></li><div class=subtree></div></ul></div></div></div></section><section class=content-section id=content-section><div class=content><div class="container p-0 read-area"><div class="hero-area col-sm-12" id=hero-area style=background-image:url(/posts/manipulator_kinematics/hero.png)></div><div class=page-content><div style=margin-bottom:80px></div><div class=title><h1>マニピュレータ制御①～順運動学、逆運動学～</h1></div><div class="author-profile ms-auto align-self-lg-center"><p class=text-muted>Sunday, July 14, 2024 | 2 minutes</p></div><div class=tags><ul style=padding-left:0></ul></div><div class=post-content id=post-content><h2 id=制作過程ロボットアーム>制作過程（ロボットアーム）</h2><p>5自由度のマニピュレータを制作、制御します。マニピュレータで物を掴んだり、手書き文字を書いたり、イラストを描いたりすることが最終的な目標です。</p><p>あくまで趣味の延長として取り組んでいますが、将来的に私の研究の実証実験などで利用できれば一石二鳥と考えています。<br>また、サーボを手に入れるのに時間がかかりそうなので、まずは制御から取り掛かります。</p><p>この記事では、一度にマニピュレータの制御についてまとめると文章量が膨大になるため複数回に分けて記述します。<br>今回は、マニピュレータの先端速度を制御する術について書いていきます。</p><p>一般に順運動学とは、関節の角速度から先端速度や先端姿勢を求めることであり、逆運動学とは、先端速度や先端姿勢から関節の角速度を求めることをいいます。</p><p>今回作成するマニピュレータでは、直接的に操作できるパラメータは各関節のサーボの角速度であるため、マニピュレータの先端速度、姿勢を実現するために必要な関節角速度を求めることができる逆運動学を解くことが目標です。</p><p>そのためにまずは順運動学から計算して、関節角速度から先端速度、姿勢に変換する変換行列である「ヤコビアン」を計算します。</p><h3 id=マニピュレータの定義>マニピュレータの定義</h3><p>今回想定しているロボットアームはこのような5自由度の関節をもつマニピュレータです。<br>手先については、タスクに応じて手先にグリッパなどを取り付けたいと考えています。</p><p><figure><img src=/posts/manipulator_kinematics/robot.drawio.png><figcaption><h4>5自由度マニピュレータのモデル</h4></figcaption></figure>　　</p><table><thead><tr><th>文字</th><th>定義</th></tr></thead><tbody><tr><td>$\bm{r}$</td><td>先端の座標ベクトル [cm]</td></tr><tr><td>$θ_i$</td><td>関節$i$の角度 [rad]</td></tr><tr><td>$\bm{l_i}$</td><td>リンク$i$の長さのベクトル [cm]</td></tr><tr><td>$\Sigma_i$</td><td>座標系$i$</td></tr></tbody></table><p>太い矢印部分がマニピュレータの本体になり、回転軸が設定されている箇所に関節が存在します。<br>また、$\Sigma_i$の原点から$\Sigma_g$の原点までのベクトルを$\bm{P_i^g}$と定義します。</p><p>続いて、3次元（SE(3)）空間での回転行列、手先姿勢は以下のように定義します。</p><table><thead><tr><th>文字</th><th>定義</th></tr></thead><tbody><tr><td>$\bm{R_i^g}$</td><td>$\Sigma_i$から見た$\Sigma_g$の姿勢を表す回転行列</td></tr><tr><td>$\alpha$</td><td>手先の姿勢　Roll [rad]</td></tr><tr><td>$\beta$</td><td>手先の姿勢　Yaw [rad]</td></tr></tbody></table><p>このとき、$\bm{R_0^1}$、$\bm{R_4^5}$はz軸周りの回転であり、$\bm{R_1^2}$、$\bm{R_2^3}$、$\bm{R_3^4}$はx軸周りの回転であることから、回転行列は以下の通りです。<br>※視認性を良くするため、cos($θ_i$)は$c_i$、cos($θ_i$)*cos($θ_g$)は$c_{ig}$と記述します（sinも同様）</p><p>$$
\bm{R_0^1} = \bm{R_4^5} =
\begin{pmatrix}
c_i & -s_i & 0 \\
s_i & c_i & 0 \\
0 & 0 & 1 \\
\end{pmatrix}
$$
$$
\bm{R_1^2} = \bm{R_2^3} = \bm{R_3^4} =
\begin{pmatrix}
1 & 0 & 0 \\
0 & c_i & -s_i\\
0 & s_i & c_i \\
\end{pmatrix}
$$</p><h3 id=順運動学解の導出>順運動学解の導出</h3><p>$\Sigma_4$から$\Sigma_r$までは、以下のように表すことができます。
$$
\bm{P_4^r} = \bm{R_4^5} \cdot \bm{l_5} + \bm{l_4}
$$
次に$\bm{P_3^r}$は、先ほど求めた$\bm{P_4^r}$を使用して以下のように表すことができます。
$$
\bm{P_3^r} = \bm{R_3^4} \cdot \bm{P_4^r} + \bm{l_3}
$$
$$
= \bm{R_3^4} \cdot \bm{R_4^5} \cdot \bm{l_5} + \bm{R_3^4} \cdot \bm{l_4} + \bm{l_3}
$$
同様に繰り返していくことで、$\bm{P_0^r}$は以下のように表すことができます。
$$
\bm{P_0^r} = \bm{R_0^1} \cdot \bm{R_1^2} \cdot \bm{R_2^3} \cdot \bm{R_3^4} \cdot \bm{R_4^5} \cdot \bm{l_5}
$$
$$
+\bm{R_0^1} \cdot \bm{R_1^2} \cdot \bm{R_2^3} \cdot \bm{R_3^4} \cdot \bm{l_4}
$$
$$
+\bm{R_0^1} \cdot \bm{R_1^2} \cdot \bm{R_2^3} \cdot \bm{l_3}
$$
$$
+\bm{R_0^1} \cdot \bm{R_1^2} \cdot \bm{l_2}
$$
$$
+\bm{R_0^1} \cdot \bm{l_1}
$$
$$
+\bm{l_0}
$$</p><p>以上により、$\bm{P_0^r}$が求まりました。</p><p>実際に計算した値がこちらです。（変数th$i$は、$θ_i$）</p><p><figure><img src=/posts/manipulator_kinematics/P0r.png><figcaption><h4>MATLABで計算した$\bm{P_0^r}$</h4></figcaption></figure>　　</p><p>続いては、$\bm{P_0^r}$の式から実際にヤコビアンを計算していきます。<br>そのためにまずは、以下の$\bm{A}$、$\bm{G}$を定義します。</p><p>$$
\bm{A} = \frac{d}{dt}
\begin{pmatrix}
\bm{P_0^r} \\
\alpha \\
\beta \\
\end{pmatrix}
$$
$$
\bm{G} =
\frac{d}{dt}
\begin{pmatrix}
θ_1 \\
θ_2 \\
θ_3 \\
θ_4 \\
θ_5 \\
\end{pmatrix}
$$</p><p>そして、$\bm{P_0^r}$の時間微分を利用することで、以下の式が成り立つようなヤコビアン$\bm{J}$を求めます。</p><p>$$
\bm{A} = \bm{J} \cdot \bm{G}
$$
$$
\bm{J} =
\begin{pmatrix}
\frac{d}{dθ_1}\bm{P_0^r} & \frac{d}{dθ_2}\bm{P_0^r} & \frac{d}{dθ_3}\bm{P_0^r} & \frac{d}{dθ_4}\bm{P_0^r} & \frac{d}{dθ_5}\bm{P_0^r} \\
0 & 1 & 1 & 1 & 0 \\
1 & 0 & 0 & 0 & 1 \\
\end{pmatrix}
$$</p><p>実際に計算されたヤコビアンは式が長すぎるので、ここでは省略します。</p><h3 id=逆運動学解の導出>逆運動学解の導出</h3><p>最後にやっと逆運動学解が求められます。<br>逆運動学は、先端速度、先端姿勢から関節角速度を求められればよいので、以下のような式が成り立つ$\bm{J}^{-1}$を求めます。<br>$$
\bm{G} = \bm{J}^{-1} \cdot \bm{A}
$$
今回のマニピュレータは5自由度で手先
$
\bm{G}
$
を制御しようとしているため、求めたヤコビアン$\bm{J}$は特異姿勢以外では、正則な行列となるため逆行列が存在します。</p><p>逆行列が存在しているため、そのまま$\bm{J}$の逆行列を求めることができれば、$\bm{J}^{-1}$が逆運動学解になります。<br>（関節の数が多いマニピュレータなど、冗長性がある場合は、別の手段をとる必要がある）</p><p>実際に計算された逆ヤコビアンは式が長すぎるので、ここでは省略します。</p><h3 id=まとめ>まとめ</h3><p>はじめに順運動学から計算していくことで、ヤコビアンを求め、その逆行列を計算して逆運動学解を求めました。<br>次回は、トルクの計算か制御システムを実装してリモコンで手先制御などを行う予定です。</p></div><div class="row ps-3 pe-3"><div class="col-md-6 share-buttons"><strong>Share on:</strong>
<a class="btn icon-button bg-facebook" href="https://www.facebook.com/sharer.php?u=https%3a%2f%2ftakanezawa0829.github.io%2fposts%2fmanipulator_kinematics%2f" target=_blank><i class="fab fa-facebook"></i>
</a><a class="btn icon-button bg-twitter" href="https://twitter.com/share?url=https%3a%2f%2ftakanezawa0829.github.io%2fposts%2fmanipulator_kinematics%2f&text=%e3%83%9e%e3%83%8b%e3%83%94%e3%83%a5%e3%83%ac%e3%83%bc%e3%82%bf%e5%88%b6%e5%be%a1%e2%91%a0%ef%bd%9e%e9%a0%86%e9%81%8b%e5%8b%95%e5%ad%a6%e3%80%81%e9%80%86%e9%81%8b%e5%8b%95%e5%ad%a6%ef%bd%9e&via=Takane%27s%20Site" target=_blank><i class="fab fa-twitter"></i>
</a><a class="btn icon-button" href="mailto:?subject=%e3%83%9e%e3%83%8b%e3%83%94%e3%83%a5%e3%83%ac%e3%83%bc%e3%82%bf%e5%88%b6%e5%be%a1%e2%91%a0%ef%bd%9e%e9%a0%86%e9%81%8b%e5%8b%95%e5%ad%a6%e3%80%81%e9%80%86%e9%81%8b%e5%8b%95%e5%ad%a6%ef%bd%9e&body=https%3a%2f%2ftakanezawa0829.github.io%2fposts%2fmanipulator_kinematics%2f" target=_blank><i class="fas fa-envelope-open-text"></i></a></div></div><hr><div class="row next-prev-navigator"></div><hr></div></div></div><a id=scroll-to-top class=btn type=button data-bs-toggle=tooltip data-bs-placement=left title="Scroll to top"><i class="fas fa-chevron-circle-up"></i></a></section><section class=toc-section id=toc-section><div class=toc-holder><h5 class="text-center ps-3">Table of Contents</h5><hr><div class=toc><nav id=TableOfContents><ul><li><a href=#制作過程ロボットアーム>制作過程（ロボットアーム）</a><ul><li><a href=#マニピュレータの定義>マニピュレータの定義</a></li><li><a href=#順運動学解の導出>順運動学解の導出</a></li><li><a href=#逆運動学解の導出>逆運動学解の導出</a></li><li><a href=#まとめ>まとめ</a></li></ul></li></ul></nav></div></div></section></div><footer id=footer class="container-fluid text-center align-content-center footer pb-2"><div class="container pt-5"><div class="row text-start"><div class="col-md-4 col-sm-12"><h5>Navigation</h5><ul><li class=nav-item><a class=smooth-scroll href=https://takanezawa0829.github.io/#about>About</a></li><li class=nav-item><a class=smooth-scroll href=https://takanezawa0829.github.io/#skills>Skills</a></li><li class=nav-item><a class=smooth-scroll href=https://takanezawa0829.github.io/#experiences>Experiences</a></li><li class=nav-item><a class=smooth-scroll href=https://takanezawa0829.github.io/#recent-posts>Recent Works</a></li></ul></div><div class="col-md-4 col-sm-12"><h5>Contact me:</h5><ul><li><a href=mailto:takanen20010829kota@gmail.com target=_blank rel=noopener><span><i class="fas fa-envelope"></i></span> <span>takanen20010829kota@gmail.com</span></a></li><li><a href=https://github.com/takanezawa0829 target=_blank rel=noopener><span><i class="fab fa-github"></i></span> <span>takanezawa0829</span></a></li></ul></div></div></div><hr><div class=container><div class="row text-start"><div class=col-md-4></div><div class="col-md-4 text-center">© 2024 Copyright.</div><div class="col-md-4 text-end"></div></div></div></footer><script src=/application.e89e293fecd862012e8fd7bacf9274742d4b63497551754134149cdc5a2fd57b.js integrity="sha256-6J4pP+zYYgEuj9e6z5J0dC1LY0l1UXVBNBSc3Fov1Xs=" defer></script></body></html>